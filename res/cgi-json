#!/bin/sh
# BusyBox httpd CGI wrapper for Prudynt JSON API
# Install/mount this as /cgi-bin/json (or symlink) under your httpd config.
# It reads the request body and forwards it to prudyntctl over the local UDS.

# Respond as JSON
echo "Content-Type: application/json"
echo

# If CONTENT_LENGTH is provided (typical POST), read exactly that many bytes.
# Otherwise, read all of stdin (supports: curl --data-binary @-).
if [ -n "$CONTENT_LENGTH" ]; then
  dd bs=1 count="$CONTENT_LENGTH" 2>/dev/null | prudyntctl json -
else
  prudyntctl json -
fi

